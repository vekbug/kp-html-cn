"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}define(["knockout","util","appinfo"],function(r,t,e){var n=new URLSearchParams(location.search),a=n.get("id"),o=null,i=n.get("pkg")||"7",l=e.package_infos[i],s={};function c(){new ClipboardJS(".download",{text:function(){return t.format(s)}}),$.os.android?e.fetch(o.chid,function(t){var e,n;console.log("Loading iframe: "+t.download_url),e=t.download_url,n=document.createElement("iframe"),$(n).css({width:0,height:0,position:"absolute",left:"-5000px"}),n.onload=function(){document.body.removeChild(n)},n.src=e,document.body.appendChild(n)}):$.os.ios?window.top.location.href=l.url:alert("只支持 Android 和 iOS 设备！")}return{init:function(){var t;t=a,$.ajax({url:"https://sem-api.zhangzhongyun.com/api/tpl/getinfobyid?id="+t,dataType:"jsonp",success:function(t){0===t.code?(o=t.data,document.title=o.mp_name||"掌中云",o.chid?(e.fetch(o.chid),s.zzy=o.chid,"2"===o.status?(r.components.register("container",{viewModel:function(){this.download=c,this.ui=function(){return["71212","71213","71214"].indexOf(o.chid)}},template:{element:"reviewing-template"}}),r.applyBindings()):$.ajax({url:"https://api.818tu.com/v1/jsonp/bidding?articles="+(o.display_article_count||2)+"&latest_entry=0&id="+o.novel_id,dataType:"jsonp",success:function(t){if(t.error)alert(t.error);else{var e=t.data.novel,n=t.data.articles,a=e.summary.split("\n").map(function(t){var e=t.replace(/^[\s　]+/g,"");return e?'<p class="paragraph">'+e+"</p>":""}).join(""),i=n.map(function(t){var e=t.content.split("\n"),n=e.map(function(t){var e=t.replace(/^[\s　]+/g,"");return e?'<p class="paragraph">'+e+"</p>":""});return{section:(n=['<div class="title"><h3>'+t.title+"</h3></div>"].concat(_toConsumableArray(n))).join("")}});s.pnid=o.novel_id,s.pnext_idx=(o.display_article_count||2)+1,o.alias_id&&(s.palias_id=o.alias_id),r.components.register("container",{viewModel:function(){this.title=r.observable(o.title),this.banner=r.observable(o.banner),this.summary=r.observable(a),this.articles=r.observableArray(i),this.download=c},template:{element:"normal-template"}}),r.applyBindings()}},error:function(){alert("发生错误")}})):alert("缺失chid")):alert("找不到该推广数据")},error:function(){alert("发生错误")}})}}});