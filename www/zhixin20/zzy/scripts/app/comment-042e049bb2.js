"use strict";define(["util","appinfo","knockout"],function(o,n,e){var t=new URLSearchParams(location.search),a=o.isWechat(),i=t.get("app_package_type"),r=o.getIosLink(),s=i?n.package_infos[i]:null,c=parseInt(t.get("chid"))?t.get("chid"):$.os.ios?60972:60593,l=void 0,u={thumb:e.observable("//qcdn.zhangzhongyun.com/spa/koala@2x.png"),likes:e.observable(),grids:e.observableArray(),content:e.observable(),nickname:e.observable(),post:{thumb:e.observable(),content:e.observable()}};function d(o){var n=document.createElement("iframe");$(n).css({width:0,height:0,position:"absolute",left:"-5000px"}),n.onload=function(){document.body.removeChild(n)},n.src=o,document.body.appendChild(n)}function p(){if($.os.android)a?l.show():n.fetch(c,function(o){console.log("Loading iframe: "+o.download_url),d(o.download_url)});else if($.os.ios)if(s){if(!s.url)return void alert("对不起，暂不支持iOS下载");window.top.location.href=s.url}else window.top.location.href=r;else n.fetch(c,function(o){console.log("Loading iframe: "+o.download_url),d(o.download_url)})}return console.log("PkgInfo",s),{init:function(){l=$("#masker"),n.fetch(c),e.applyBindings(u,document.body),$.ajax({url:"https://api.818tu.com/v1/jsonp/forum/comments/"+t.get("id"),dataType:"jsonp",success:function(o){var n=o.error,e=o.data;n&&alert(n),e&&(u.likes(e.like_count),u.nickname(e.nickname),u.thumb(e.headimgurl),u.content(e.content),u.grids(e.image_urls)),$.ajax({url:"https://api.818tu.com/v1/jsonp/forum/posts/"+e.post_id,dataType:"jsonp",success:function(o){var n=o.data;n&&(u.post.content(n.content),n.image_urls.length&&u.post.thumb(n.image_urls[0]))},error:function(){alert("发生错误")}})},error:function(){alert("发生错误")}}),$.os.ios&&new ClipboardJS(".btn-down-app",{text:function(){return"zzy:"+c}}),l.tap(function(){return l.hide()}),$(document.body).on("tap",".btn-down-app",p),$.os.ios&&s&&($(".logo").css("background-image",'url("'+s.logo+'")'),document.title=s.name,$(".js-app-name").html(s.name))}}});