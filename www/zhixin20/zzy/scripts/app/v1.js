"use strict";define(["util","appinfo","track","knockout"],function(i,r,s,d){var l=new URLSearchParams(location.search),t=i.isWechat(),c=l.get("chid")?l.get("chid").toLowerCase().replace(/s.*-/g,""):{"dl.zhangzhongyun.com":35881}[location.hostname]||33534,o=l.get("pkg")||"7",e=(l.get("source")||"").toLowerCase(),u=r.package_infos[o],p=void 0,g=void 0,h={title:d.observable("加载中..."),alias:d.observable(),roles:d.observable("加载中..."),intro:d.observable("加载中..."),status:d.observable("加载中..."),avatar:d.observable(),tags:d.observableArray(),last_entry_idx:d.observable(""),last_entry_title:d.observable(""),copyright:d.observable("")},b={zzy:c};function v(){if("baidu"!==e||!$(this).hasClass("entry")){if(!$.os.android)return $.os.ios?(_hmt.push(["_trackEvent","download","ios",h.title()]),void(window.top.location.href=u.url)):void alert("只支持 Android 和 iOS 设备！");t?p.show():(_hmt.push(["_trackEvent","download","android",h.title()]),r.fetch(c,function(t){var o,e;console.log("Loading iframe: "+t.download_url),o=t.download_url,e=document.createElement("iframe"),$(e).css({width:0,height:0,position:"absolute",left:"-5000px"}),e.onload=function(){document.body.removeChild(e)},e.src=o,document.body.appendChild(e)}))}}return{init:function(t){var a,o;p=$("#masker"),g=$(".js-download"),r.fetch(c),s.required()&&(b=s.params(c),s.post(b)),h.copyright(t),d.applyBindings(h,document.body),a={ongoing:"连载中",completed:"已完结"},o=l.get("title"),$.ajax({url:"https://api.818tu.com/v1/jsonp/bidding?id="+l.get("id")+"&title="+encodeURIComponent(o),dataType:"jsonp",success:function(t){if(t.error)alert(t.error);else{var o=t.data.novel,e=t.data.entry;h.title(o.title),h.roles(o.roles),h.intro(o.summary),h.status(a[o.status]),h.avatar(o.avatar),o.tags&&h.tags(o.tags.split(",")),e&&(h.last_entry_idx(e.idx),h.last_entry_title(e.title)),b.pnid=l.get("id"),b.pnext_idx=1,o.alias_id&&(b.palias_id=o.alias_id),g.each(function(){new ClipboardJS(this,{text:function(){return i.format(b)}})})}},error:function(){alert("发生错误")}}),g.tap(v),p.tap(function(){return p.hide()});var e={id:0,name:"掌中小说书城",logo:"https://qcdn.zhangzhongyun.com/app/icon-xssc.png"};if($.os.ios&&u&&(e=u),e){var n="<strong>"+e.name+"</strong> - 海量精选小说，任你畅读";$("p").html(n),$(".logo").css("background-image","url('"+e.logo+"')"),$(".btn-download").addClass("btn-download-"+e.id),$(".entry").addClass("entry-"+e.id)}}}});