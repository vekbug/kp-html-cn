"use strict";define(["util","appinfo"],function(o,e){var n=new URLSearchParams(location.search),i=(o.isWechat(),n.get("chid")),t=n.get("app_package_type"),a=t?e.package_infos[t]:null,r=o.getIosLink(),c=void 0,d=void 0;function l(o){var e=document.createElement("iframe");$(e).css({width:0,height:0,position:"absolute",left:"-5000px"}),e.onload=function(){document.body.removeChild(e)},e.src=o,document.body.appendChild(e)}function s(){if($.os.android)o.isWechat()?c.show():e.fetch(i,function(o){console.log("Loading iframe: "+o.download_url),l(o.download_url)});else if($.os.ios)if(a){if(!a.url)return void alert("对不起，暂不支持iOS下载");window.top.location.href=a.url}else window.top.location.href=r;else e.fetch(i,function(o){console.log("Loading iframe: "+o.download_url),l(o.download_url)})}return i||alert("Missing chid"),console.log("PkgInfo",a),{init:function(){c=$("#masker"),d=$(".btn-download"),e.fetch(i),$.ajax({url:"https://api.818tu.com/v1/jsonp/members/"+n.get("imid"),dataType:"jsonp",success:function(o){if(o.error)alert(o.error);else{var e=o.data;$("#avatar").css({backgroundImage:"url('"+e.headimgurl+"')"}),$("#nickname").text(e.nickname)}},error:function(){console.log("发生错误")}}),d.tap(s),c.tap(function(){return c.hide()}),d.each(function(){new ClipboardJS(this,{text:function(){return"zzy:"+i+"|pkg:"+t+"|imid:"+n.get("imid")+"|idid:"+n.get("idid")}})}),$.os.ios&&a&&($(".app").html(a.name),$(".logo").css("background-image",'url("'+a.logo+'")')),document.title=a?a.name:"掌中云"}}});