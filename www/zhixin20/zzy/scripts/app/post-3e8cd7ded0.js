"use strict";define(["util","appinfo","knockout"],function(o,n,e){var t=new URLSearchParams(location.search),a=o.isWechat(),i=t.get("app_package_type"),r=o.getIosLink(),c=i?n.package_infos[i]:null,s=parseInt(t.get("chid"))?t.get("chid"):$.os.ios?60972:60593,l=void 0,u={thumb:e.observable("//qcdn.zhangzhongyun.com/spa/koala@2x.png"),likes:e.observable(),grid:e.observableArray(),content:e.observable(),nickname:e.observable(),comments:e.observableArray()};function d(o){var n=document.createElement("iframe");$(n).css({width:0,height:0,position:"absolute",left:"-5000px"}),n.onload=function(){document.body.removeChild(n)},n.src=o,document.body.appendChild(n)}function m(){if($.os.android)a?l.show():n.fetch(s,function(o){console.log("Loading iframe: "+o.download_url),d(o.download_url)});else if($.os.ios)if(c){if(!c.url)return void alert("对不起，暂不支持iOS下载");window.top.location.href=c.url}else window.top.location.href=r;else n.fetch(s,function(o){console.log("Loading iframe: "+o.download_url),d(o.download_url)})}return console.log("PkgInfo",c),{init:function(){l=$("#masker"),n.fetch(s),e.applyBindings(u,document.body),$.ajax({url:"https://api.818tu.com/v1/jsonp/forum/posts/"+t.get("id"),dataType:"jsonp",success:function(o){var n=o.error,e=o.data;n&&alert(n),e&&(u.likes(e.like_count),u.nickname(e.nickname),u.thumb(e.headimgurl),u.content(e.content),u.grid(e.image_urls))},error:function(){alert("发生错误")}}),$.ajax({url:"https://api.818tu.com/v1/jsonp/forum/posts/"+t.get("id")+"/comments",data:{limit:3},dataType:"jsonp",success:function(o){var n=o.data;n&&u.comments(n.map(function(o){return{grid:o.image_urls,thumb:o.headimgurl,content:o.content,nickname:o.nickname}}))}}),$.os.ios&&new ClipboardJS(".btn-down-app",{text:function(){return"zzy:"+s}}),l.tap(function(){return l.hide()}),$(document.body).on("tap",".btn-down-app",m),$.os.ios&&c&&($(".logo").css("background-image",'url("'+c.logo+'")'),document.title=c.name,$(".js-app-name").html(c.name))}}});